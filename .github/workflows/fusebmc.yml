name: FuSeBMC Analysis

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v1

    - name: Login to GitHub Container Registry
      uses: docker/login-action@v2
      with:
        registry: ghcr.io
        username: ${{ github.repository_owner }}
        password: ${{ secrets.MY_GITHUB_PAT }}

    - name: Pull FuSeBMC Docker image
      run: docker pull ghcr.io/fusebmc/fusebmc/fusebmc:latest

    - name: Run FuSeBMC on all C files
      run: |
        # Find all .c files in the repository
        for file in $(find . -name '*.c'); do
          # Run FuSeBMC on each file
          docker run --rm \
            -v ${{ github.workspace }}:/workspace \
            ghcr.io/fusebmc/fusebmc/fusebmc:latest \
            -a 64 -s incr -p /workspace/properties/coverage-error-call.prp /workspace/$file 
        done

          




